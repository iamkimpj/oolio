{
  "version": 3,
  "sources": ["../src/index.ts", "../src/request.ts"],
  "sourcesContent": ["import request from \"./request.js\";\n\ninterface Route {\n  method: string;\n  path: string;\n  payload?: string[];\n  files?: string[];\n  authorization?: boolean;\n}\n\ninterface Routes {\n  [category: string]: {\n    [fnName: string]: Route;\n  };\n}\n\ninterface OolioConfig {\n  routes: Routes;\n  getAuthorizeToken: () => string | null;\n  baseUrl: string;\n}\n\nexport default function oolio({\n  routes,\n  getAuthorizeToken,\n  baseUrl,\n}: OolioConfig) {\n  const api: Record<string, any> = {};\n\n  (function init(): void {\n    if (!routes) {\n      logForNoRoutes();\n      return;\n    } else if (!getAuthorizeToken) {\n      logForNoGetAuthorizeToken();\n      return;\n    }\n\n    for (const category in routes) {\n      if (!api[category]) {\n        api[category] = {};\n      }\n      for (const fnName in routes[category]) {\n        api[category][fnName] = (...args: any[]) => {\n          const requestFn = request(baseUrl, getAuthorizeToken);\n          return requestFn.call(routes[category][fnName], ...args);\n        };\n      }\n    }\n  })();\n\n  return api;\n}\n\nfunction logForNoRoutes(): void {\n  console.warn(`\n  [oolio] routes\uAC00 \uC815\uC758\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. routes\uB294 \uB2E4\uC74C\uACFC \uAC19\uC740 \uD615\uC2DD\uC774\uC5B4\uC57C \uD569\uB2C8\uB2E4:\n  \n  const routes = {\n    auth: {\n      login: {\n        method: 'post',\n        path: '/auth/login',\n        payload: ['email', 'password']\n      },\n      register: {\n        method: 'post',\n        path: '/auth/register',\n        payload: ['email', 'password', 'name']\n      }\n    },\n    user: {\n      getProfile: {\n        method: 'get',\n        path: '/user/profile'\n      },\n      updateProfile: {\n        method: 'put',\n        path: '/user/profile',\n        payload: ['name', 'avatar']\n      },\n      uploadAvatar: {\n        method: 'post',\n        path: '/user/avatar',\n        payload: ['userId'],\n        files: ['avatar']  // \uD30C\uC77C \uC5C5\uB85C\uB4DC \uD544\uB4DC\n      }\n    }\n  };\n  \n  \uAC01 \uB77C\uC6B0\uD2B8\uB294 \uB2E4\uC74C \uC18D\uC131\uC744 \uAC00\uC9C8 \uC218 \uC788\uC2B5\uB2C8\uB2E4:\n  - method: HTTP \uBA54\uC18C\uB4DC (get, post, put, delete \uB4F1)\n  - path: API \uC5D4\uB4DC\uD3EC\uC778\uD2B8 \uACBD\uB85C\n  - payload: \uC694\uCCAD\uC5D0 \uD3EC\uD568\uB420 \uB370\uC774\uD130 \uD544\uB4DC \uBAA9\uB85D (\uC120\uD0DD\uC0AC\uD56D)\n  - authorization: \uC778\uC99D \uD544\uC694 \uC5EC\uBD80 (\uAE30\uBCF8\uAC12: true)\n  - files: \uD30C\uC77C \uC5C5\uB85C\uB4DC \uD544\uB4DC \uBAA9\uB85D (\uC120\uD0DD\uC0AC\uD56D)\n  `);\n}\n\nfunction logForNoGetAuthorizeToken(): void {\n  console.log(\"getAuthorizeToken is undefined\");\n}\n", "interface PathParams {\n  [key: string]: string;\n}\n\ninterface Data {\n  [key: string]: any;\n}\n\ninterface Headers {\n  [key: string]: string;\n}\n\ninterface RouteConfig {\n  method: string;\n  path: string;\n  payload?: string[];\n  baseUrl?: string;\n  authorization?: string | boolean;\n  files?: string[];\n}\n\ninterface PayloadDefinition {\n  defaultValue?: any;\n}\n\nconst hasParams = (path: string): boolean => {\n  const paramPattern = /\\/\\{[^}]+\\}/g;\n  return paramPattern.test(path);\n};\n\nconst hasFiles = (fileIndex?: string[]): boolean => {\n  if (!fileIndex) return false;\n  return fileIndex.length > 0;\n};\n\nconst convQueryParamsForGet = (\n  payload: string[] | { [key: string]: PayloadDefinition } = [],\n  data: Data = {}\n): Data => {\n  const query: Data = {};\n  if (Array.isArray(payload)) {\n    for (const key in data) {\n      if (payload.indexOf(key) !== -1) {\n        query[key] =\n          data[key] === undefined || data[key] === null\n            ? \"\"\n            : typeof data[key] === \"object\"\n            ? JSON.stringify(data[key])\n            : data[key];\n      }\n    }\n  } else {\n    for (const key in payload) {\n      if (data[key] !== undefined) {\n        query[key] =\n          data[key] == null\n            ? \"\"\n            : typeof data[key] === \"object\"\n            ? JSON.stringify(data[key])\n            : data[key];\n      } else {\n        const definition = payload[key];\n        if (definition) {\n          query[key] = definition.defaultValue;\n        }\n      }\n    }\n  }\n  return query;\n};\n\nconst getBodyFromDataWithFile = (\n  payload: string[] = [],\n  fileIndex: string[] = [],\n  data: Data = {}\n): FormData => {\n  const formData = new FormData();\n  const filteredData = convQueryParamsForGet(payload, data);\n\n  // payload\uC5D0 \uD3EC\uD568\uB41C \uD544\uB4DC \uCC98\uB9AC\n  for (const key in filteredData) {\n    const encodedKey = encodeURIComponent(key);\n    const encodedValue = encodeURIComponent(filteredData[key]);\n    formData.append(encodedKey, encodedValue);\n  }\n\n  // files\uC5D0 \uD3EC\uD568\uB41C \uD544\uB4DC \uCC98\uB9AC\n  for (const key in data) {\n    if (fileIndex.includes(key)) {\n      formData.append(key, data[key]);\n    }\n  }\n\n  return formData;\n};\n\nconst getBodyFromData = (payload: string[] = [], data: Data = {}): FormData => {\n  const filteredData = convQueryParamsForGet(payload, data);\n  const formData = new FormData();\n\n  for (const key in filteredData) {\n    formData.append(key, filteredData[key]);\n  }\n  return formData;\n};\n\nconst setPath = (path: string, pathParams: PathParams = {}): string => {\n  if (!path) {\n    console.log(\"path is undefined\");\n    return path;\n  }\n\n  // \uACBD\uB85C \uD30C\uB77C\uBBF8\uD130\uAC00 \uC788\uB294\uC9C0 \uD655\uC778\n  if (!hasParams(path)) {\n    return path;\n  }\n\n  // \uAC01 \uACBD\uB85C \uD30C\uB77C\uBBF8\uD130\uB97C \uC2E4\uC81C \uAC12\uC73C\uB85C \uCE58\uD658\n  let modifiedPath = path;\n  for (const [key, value] of Object.entries(pathParams)) {\n    const paramPattern = new RegExp(`\\\\{${key}\\\\}`, \"g\");\n    modifiedPath = modifiedPath.replace(paramPattern, value);\n  }\n\n  return modifiedPath;\n};\n\nconst runGetApi = async (\n  url: string,\n  payload: string[],\n  queryParams: Data = {},\n  headers: Headers = {}\n): Promise<any> => {\n  const query = convQueryParamsForGet(payload, queryParams);\n\n  const response = await fetch(\n    `${url}?${new URLSearchParams(query).toString()}`,\n    {\n      headers,\n    }\n  );\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw {\n      status: response.status,\n      statusText: response.statusText,\n      data: error,\n    };\n  }\n  return response.json();\n};\n\nconst runApi = async (\n  url: string,\n  method: string,\n  payload: string[],\n  data: Data = {},\n  headers: Headers = {}\n): Promise<any> => {\n  const body = getBodyFromData(payload, data);\n  const response = await fetch(url, {\n    method,\n    headers,\n    body,\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw {\n      status: response.status,\n      statusText: response.statusText,\n      data: error,\n    };\n  }\n  return response.json();\n};\n\nconst runApiWithFiles = async (\n  url: string,\n  method: string,\n  payload: string[],\n  fileIndex: string[] = [],\n  data: Data = {},\n  headers: Headers = {}\n): Promise<any> => {\n  const body = getBodyFromDataWithFile(payload, fileIndex, data);\n\n  if (!headers[\"Content-Type\"]) {\n    headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n  }\n\n  const response = await fetch(url, {\n    method,\n    headers,\n    body,\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw {\n      status: response.status,\n      statusText: response.statusText,\n      data: error,\n    };\n  }\n  return response.json();\n};\n\nexport default function createOolio(\n  _baseUrl: string,\n  getAuthorizeToken: () => string | null\n) {\n  return async function request(\n    this: RouteConfig,\n    pathParams: PathParams = {},\n    data: Data | null = null,\n    headers: Headers = {}\n  ): Promise<any> {\n    const {\n      method,\n      path,\n      payload = [],\n      baseUrl = null,\n      authorization = null,\n      files = undefined,\n    } = this;\n\n    let url = baseUrl ? baseUrl : _baseUrl ? _baseUrl : \"http://localhost:3000\";\n    let requestData = data || {};\n\n    if (hasParams(path)) {\n      url = url + setPath(path, pathParams);\n    } else {\n      url = url + path;\n      if (!data) {\n        requestData = pathParams;\n      }\n    }\n\n    if (authorization !== \"guest\" && getAuthorizeToken) {\n      const token = await getAuthorizeToken();\n      if (token) {\n        headers.Authorization = `Bearer ${token}`;\n      }\n    }\n\n    if (method === \"get\") {\n      return runGetApi(url, payload, requestData, headers);\n    } else if (hasFiles(files)) {\n      return runApiWithFiles(url, method, payload, files, requestData, headers);\n    } else {\n      return runApi(url, method, payload, requestData, headers);\n    }\n  };\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GCyBA,IAAMI,EAAaC,GACI,eACD,KAAKA,CAAI,EAGzBC,EAAYC,GACXA,EACEA,EAAU,OAAS,EADH,GAInBC,EAAwB,CAC5BC,EAA2D,CAAC,EAC5DC,EAAa,CAAC,IACL,CACT,IAAMC,EAAc,CAAC,EACrB,GAAI,MAAM,QAAQF,CAAO,EACvB,QAAWG,KAAOF,EACZD,EAAQ,QAAQG,CAAG,IAAM,KAC3BD,EAAMC,CAAG,EACPF,EAAKE,CAAG,IAAM,QAAaF,EAAKE,CAAG,IAAM,KACrC,GACA,OAAOF,EAAKE,CAAG,GAAM,SACrB,KAAK,UAAUF,EAAKE,CAAG,CAAC,EACxBF,EAAKE,CAAG,OAIlB,SAAWA,KAAOH,EAChB,GAAIC,EAAKE,CAAG,IAAM,OAChBD,EAAMC,CAAG,EACPF,EAAKE,CAAG,GAAK,KACT,GACA,OAAOF,EAAKE,CAAG,GAAM,SACrB,KAAK,UAAUF,EAAKE,CAAG,CAAC,EACxBF,EAAKE,CAAG,MACT,CACL,IAAMC,EAAaJ,EAAQG,CAAG,EAC1BC,IACFF,EAAMC,CAAG,EAAIC,EAAW,aAE5B,CAGJ,OAAOF,CACT,EAEMG,EAA0B,CAC9BL,EAAoB,CAAC,EACrBF,EAAsB,CAAC,EACvBG,EAAa,CAAC,IACD,CACb,IAAMK,EAAW,IAAI,SACfC,EAAeR,EAAsBC,EAASC,CAAI,EAGxD,QAAWE,KAAOI,EAAc,CAC9B,IAAMC,EAAa,mBAAmBL,CAAG,EACnCM,EAAe,mBAAmBF,EAAaJ,CAAG,CAAC,EACzDG,EAAS,OAAOE,EAAYC,CAAY,CAC1C,CAGA,QAAWN,KAAOF,EACZH,EAAU,SAASK,CAAG,GACxBG,EAAS,OAAOH,EAAKF,EAAKE,CAAG,CAAC,EAIlC,OAAOG,CACT,EAEMI,EAAkB,CAACV,EAAoB,CAAC,EAAGC,EAAa,CAAC,IAAgB,CAC7E,IAAMM,EAAeR,EAAsBC,EAASC,CAAI,EAClDK,EAAW,IAAI,SAErB,QAAWH,KAAOI,EAChBD,EAAS,OAAOH,EAAKI,EAAaJ,CAAG,CAAC,EAExC,OAAOG,CACT,EAEMK,EAAU,CAACf,EAAcgB,EAAyB,CAAC,IAAc,CACrE,GAAI,CAAChB,EACH,eAAQ,IAAI,mBAAmB,EACxBA,EAIT,GAAI,CAACD,EAAUC,CAAI,EACjB,OAAOA,EAIT,IAAIiB,EAAejB,EACnB,OAAW,CAACO,EAAKW,CAAK,IAAK,OAAO,QAAQF,CAAU,EAAG,CACrD,IAAMG,EAAe,IAAI,OAAO,MAAMZ,CAAG,MAAO,GAAG,EACnDU,EAAeA,EAAa,QAAQE,EAAcD,CAAK,CACzD,CAEA,OAAOD,CACT,EAEMG,EAAY,MAChBC,EACAjB,EACAkB,EAAoB,CAAC,EACrBC,EAAmB,CAAC,IACH,CACjB,IAAMjB,EAAQH,EAAsBC,EAASkB,CAAW,EAElDE,EAAW,MAAM,MACrB,GAAGH,CAAG,IAAI,IAAI,gBAAgBf,CAAK,EAAE,SAAS,CAAC,GAC/C,CACE,QAAAiB,CACF,CACF,EAEA,GAAI,CAACC,EAAS,GAAI,CAChB,IAAMC,EAAQ,MAAMD,EAAS,KAAK,EAClC,KAAM,CACJ,OAAQA,EAAS,OACjB,WAAYA,EAAS,WACrB,KAAMC,CACR,CACF,CACA,OAAOD,EAAS,KAAK,CACvB,EAEME,EAAS,MACbL,EACAM,EACAvB,EACAC,EAAa,CAAC,EACdkB,EAAmB,CAAC,IACH,CACjB,IAAMK,EAAOd,EAAgBV,EAASC,CAAI,EACpCmB,EAAW,MAAM,MAAMH,EAAK,CAChC,OAAAM,EACA,QAAAJ,EACA,KAAAK,CACF,CAAC,EAED,GAAI,CAACJ,EAAS,GAAI,CAChB,IAAMC,EAAQ,MAAMD,EAAS,KAAK,EAClC,KAAM,CACJ,OAAQA,EAAS,OACjB,WAAYA,EAAS,WACrB,KAAMC,CACR,CACF,CACA,OAAOD,EAAS,KAAK,CACvB,EAEMK,EAAkB,MACtBR,EACAM,EACAvB,EACAF,EAAsB,CAAC,EACvBG,EAAa,CAAC,EACdkB,EAAmB,CAAC,IACH,CACjB,IAAMK,EAAOnB,EAAwBL,EAASF,EAAWG,CAAI,EAExDkB,EAAQ,cAAc,IACzBA,EAAQ,cAAc,EAAI,qCAG5B,IAAMC,EAAW,MAAM,MAAMH,EAAK,CAChC,OAAAM,EACA,QAAAJ,EACA,KAAAK,CACF,CAAC,EAED,GAAI,CAACJ,EAAS,GAAI,CAChB,IAAMC,EAAQ,MAAMD,EAAS,KAAK,EAClC,KAAM,CACJ,OAAQA,EAAS,OACjB,WAAYA,EAAS,WACrB,KAAMC,CACR,CACF,CACA,OAAOD,EAAS,KAAK,CACvB,EAEe,SAARM,EACLC,EACAC,EACA,CACA,OAAO,eAELhB,EAAyB,CAAC,EAC1BX,EAAoB,KACpBkB,EAAmB,CAAC,EACN,CACd,GAAM,CACJ,OAAAI,EACA,KAAA3B,EACA,QAAAI,EAAU,CAAC,EACX,QAAA6B,EAAU,KACV,cAAAC,EAAgB,KAChB,MAAAC,EAAQ,MACV,EAAI,KAEAd,EAAMY,GAAoBF,GAAsB,wBAChDK,EAAc/B,GAAQ,CAAC,EAW3B,GATIN,EAAUC,CAAI,EAChBqB,EAAMA,EAAMN,EAAQf,EAAMgB,CAAU,GAEpCK,EAAMA,EAAMrB,EACPK,IACH+B,EAAcpB,IAIdkB,IAAkB,SAAWF,EAAmB,CAClD,IAAMK,EAAQ,MAAML,EAAkB,EAClCK,IACFd,EAAQ,cAAgB,UAAUc,CAAK,GAE3C,CAEA,OAAIV,IAAW,MACNP,EAAUC,EAAKjB,EAASgC,EAAab,CAAO,EAC1CtB,EAASkC,CAAK,EAChBN,EAAgBR,EAAKM,EAAQvB,EAAS+B,EAAOC,EAAab,CAAO,EAEjEG,EAAOL,EAAKM,EAAQvB,EAASgC,EAAab,CAAO,CAE5D,CACF,CDzOe,SAARe,EAAuB,CAC5B,OAAAC,EACA,kBAAAC,EACA,QAAAC,CACF,EAAgB,CACd,IAAMC,EAA2B,CAAC,EAElC,OAAC,UAAsB,CACrB,GAAKH,GAGE,GAAI,CAACC,EAAmB,CAC7BG,EAA0B,EAC1B,MACF,MANa,CACXC,EAAe,EACf,MACF,CAKA,QAAWC,KAAYN,EAAQ,CACxBG,EAAIG,CAAQ,IACfH,EAAIG,CAAQ,EAAI,CAAC,GAEnB,QAAWC,KAAUP,EAAOM,CAAQ,EAClCH,EAAIG,CAAQ,EAAEC,CAAM,EAAI,IAAIC,IACRC,EAAQP,EAASD,CAAiB,EACnC,KAAKD,EAAOM,CAAQ,EAAEC,CAAM,EAAG,GAAGC,CAAI,CAG7D,CACF,EAAG,EAEIL,CACT,CAEA,SAASE,GAAuB,CAC9B,QAAQ,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAyCZ,CACH,CAEA,SAASD,GAAkC,CACzC,QAAQ,IAAI,gCAAgC,CAC9C",
  "names": ["src_exports", "__export", "oolio", "__toCommonJS", "hasParams", "path", "hasFiles", "fileIndex", "convQueryParamsForGet", "payload", "data", "query", "key", "definition", "getBodyFromDataWithFile", "formData", "filteredData", "encodedKey", "encodedValue", "getBodyFromData", "setPath", "pathParams", "modifiedPath", "value", "paramPattern", "runGetApi", "url", "queryParams", "headers", "response", "error", "runApi", "method", "body", "runApiWithFiles", "createOolio", "_baseUrl", "getAuthorizeToken", "baseUrl", "authorization", "files", "requestData", "token", "oolio", "routes", "getAuthorizeToken", "baseUrl", "api", "logForNoGetAuthorizeToken", "logForNoRoutes", "category", "fnName", "args", "createOolio"]
}
